<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper
        PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
        "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.kzm.blog.mapper.category.CategoryMapper">
    <resultMap id="BaseResultMap" type="com.kzm.blog.common.entity.category.CategoryEntity">
        <id property="id" column="id"></id>
        <result property="categoryName" column="category_name"></result>
        <result property="avatar" column="avatar"></result>
        <result property="parentId" column="parent_id"></result>
    </resultMap>

    <sql id="Base_Column_List">
        id,category_name,avatar,parent_id
    </sql>

    <select id="selectCategoryVoPage" resultType="com.kzm.blog.common.entity.category.vo.CategoryVo">
        select
           c.id,
           c.category_name,
           c.avatar,
           count(a.category_id) as articles
           from  category c left join  article a on instr(category_id,c.id)
           <where>
              <if test="categoryBo.id==null or categoryBo.id == ''">
                   c.parent_id !='-1'
              </if>
               <if test="categoryBo.id !=null and categoryBo.id!=''">
                  c.parent_id=#{categoryBo.id}
               </if>
           </where>
            group by c.id
          <if test="categoryBo.sort !=null and category.sort !=''">
              order by categoryBo.sort
              <if test="categoryBo.sortBy !=null and categoryBo.sortBy !=''">
                     #{categoryBo.sortBy}
              </if>
          </if>

    </select>
</mapper>